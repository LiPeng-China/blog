import{_ as t,X as p,Y as i,$ as n,a0 as a,a1 as l,a2 as o,Z as s,F as c}from"./framework-bf6cbb95.js";const u={},d=s(`<h2 id="零、docker-安装" tabindex="-1"><a class="header-anchor" href="#零、docker-安装" aria-hidden="true">#</a> 零、Docker 安装</h2><p>拉取镜像：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull mongo:5.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>创建容器：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">27017</span>:27017 <span class="token parameter variable">--name</span> myMongo mongo:5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="一、mongodb-介绍" tabindex="-1"><a class="header-anchor" href="#一、mongodb-介绍" aria-hidden="true">#</a> 一、MongoDB 介绍</h2><h3 id="_1、认识-nosql" tabindex="-1"><a class="header-anchor" href="#_1、认识-nosql" aria-hidden="true">#</a> 1、认识 NoSQL</h3><ul><li>NoSQL 最常见的解释是 non-relational，Not Only SQL 也被跟多人接受</li><li>NoSQL 仅仅是一个概念，泛指非关系型数据库，区别于关系型数据库，不保证关系型数据库的 ACID 特性</li></ul><h3 id="_2、常见应用场景" tabindex="-1"><a class="header-anchor" href="#_2、常见应用场景" aria-hidden="true">#</a> 2、常见应用场景</h3><p>社交场景：</p><ul><li>聊天消息</li><li>朋友圈海量数据</li><li>搜索附近的人</li></ul><p>电商场景</p><ul><li>查询快递位置</li></ul><p>金融场景：</p><ul><li>查询用户征信信息</li><li>查询用户运营商数据</li></ul><p>特点：</p><ul><li>数据量大</li><li>读写操作频繁</li><li>价值较低的数据，对事务要求低</li></ul><p>”三高“ 问题：</p><ul><li>High performance：高并发读写需求</li><li>Huge Storge：高效率存储和访问需求</li><li>High Scalability &amp;&amp; High Availability：高可扩展和高可用需求</li></ul><p>关系型数据库的问题：</p><ul><li>数据量超过亿级，需要分库分表。但运维复杂，拓展不方便。</li></ul><h3 id="_3、mongodb-概述" tabindex="-1"><a class="header-anchor" href="#_3、mongodb-概述" aria-hidden="true">#</a> 3、MongoDB 概述</h3><ul><li>MongoDB 是基于分布式文件存储的数据库，是一个开源的、高性能、无模式的文档型数据库，是一个介于关系数据库和非关系数据库之间的产品，是非关系数据当中当中功能最丰富，最像关系数据库的。</li><li>MySQL 与 MongoDB 对比</li><li>TODO 图片</li><li></li></ul><h3 id="_4、mongodb-数据模型" tabindex="-1"><a class="header-anchor" href="#_4、mongodb-数据模型" aria-hidden="true">#</a> 4、MongoDB 数据模型</h3><ul><li>MongoDB 的最小存储单位就是文档（Document）对象。文档对象对应于关系型数据库中的行</li><li>数据在 MongoDB 中以 BSON（Binary-JSON）文档的格式存储在磁盘上</li><li>BSON 和 JSON 一样，支持内嵌的文档对象和数组对象，但是 BSON 有 JSON 没有的一些数据类型，如定义代码</li><li>BSON 数据类型参考列表（不需要记）：</li><li>TODO 图片</li></ul><h3 id="_5、mongodb-特点" tabindex="-1"><a class="header-anchor" href="#_5、mongodb-特点" aria-hidden="true">#</a> 5、MongoDB 特点</h3><p>TODO 扩展解释</p><ul><li>高性能</li><li>高可用性：MongoDB提供了复制功能副本集（replica set），提供自动故障转移</li><li>高扩展性：MongoDB 提供了水平可扩展性，提供了分片集群功能，能实现服务能力水平扩展，实现海量数据的存储</li><li>丰富的查询支持：MongoDB 支持丰富的查询语言，支持读和写操作（CRUD），比如：数据聚合、文本搜索和地理空间查询</li><li>其它特点：无模式（动态模式）、灵活的文档模型</li></ul><h3 id="_6、mongodb-单机版安装" tabindex="-1"><a class="header-anchor" href="#_6、mongodb-单机版安装" aria-hidden="true">#</a> 6、MongoDB 单机版安装</h3><h4 id="_6-1-官网下载安装包" tabindex="-1"><a class="header-anchor" href="#_6-1-官网下载安装包" aria-hidden="true">#</a> 6.1 官网下载安装包</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-6.0.12.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-2-解压" tabindex="-1"><a class="header-anchor" href="#_6-2-解压" aria-hidden="true">#</a> 6.2 解压</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-xvf</span> mongodb-linux-x86_64-rhel70-6.0.12.tgz <span class="token parameter variable">-C</span> /usr/local/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mv</span> mongodb-linux-x86_64-rhel70-6.0.12/ mongodb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-3-创建目录存放数据和日志文件" tabindex="-1"><a class="header-anchor" href="#_6-3-创建目录存放数据和日志文件" aria-hidden="true">#</a> 6.3 创建目录存放数据和日志文件</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/single/data/db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/single/log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-4-创建配置文件" tabindex="-1"><a class="header-anchor" href="#_6-4-创建配置文件" aria-hidden="true">#</a> 6.4 创建配置文件</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /usr/local/mongodb/single/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">systemLog</span><span class="token punctuation">:</span>
<span class="token key attr-name">  destination</span><span class="token punctuation">:</span> <span class="token value attr-value">file</span>
<span class="token key attr-name">  path</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;/usr/local/mongodb/single/log/mongod.log&quot;</span>
<span class="token key attr-name">  logAppend</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">storage</span><span class="token punctuation">:</span>
<span class="token key attr-name">  dbPath</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;/usr/local/mongodb/single/data/db&quot;</span>
<span class="token key attr-name">  journal</span><span class="token punctuation">:</span>
<span class="token key attr-name">    enabled</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">processManagement</span><span class="token punctuation">:</span>
<span class="token key attr-name">  fork</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">net</span><span class="token punctuation">:</span>
<span class="token key attr-name">  bindIp</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.81.128</span>
<span class="token key attr-name">  port</span><span class="token punctuation">:</span> <span class="token value attr-value">27017</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-5-下载安装-mongodb-shell" tabindex="-1"><a class="header-anchor" href="#_6-5-下载安装-mongodb-shell" aria-hidden="true">#</a> 6.5 下载安装 mongoDB Shell</h4><p>下载</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://downloads.mongodb.com/compass/mongosh-2.1.1-linux-x64.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>解压</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-xvf</span> mongosh-2.1.1-linux-x64.tgz <span class="token parameter variable">-C</span> /usr/local/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>重命名</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mv</span> mongosh-2.1.1-linux-x64/ mongosh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加命令至环境变量</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> ~/.bash_profil
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/bin:/usr/local/mongodb/bin:/usr/local/mongosh/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">source</span> ~/.bash_profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-6-启动-mongodb-服务" tabindex="-1"><a class="header-anchor" href="#_6-6-启动-mongodb-服务" aria-hidden="true">#</a> 6.6 启动 MongoDB 服务</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mongod <span class="token parameter variable">-f</span> /usr/local/mongodb/single/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> mongodb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-7-防火墙打开端口" tabindex="-1"><a class="header-anchor" href="#_6-7-防火墙打开端口" aria-hidden="true">#</a> 6.7 防火墙打开端口</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">27017</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-8-shell-连接-mongodb-服务" tabindex="-1"><a class="header-anchor" href="#_6-8-shell-连接-mongodb-服务" aria-hidden="true">#</a> 6.8 Shell 连接 MongoDB 服务</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mongosh <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token number">192.168</span>.81.128 <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">27017</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show dbs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">exit</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-9-windows-下载-mongodb-compass-压缩包解压" tabindex="-1"><a class="header-anchor" href="#_6-9-windows-下载-mongodb-compass-压缩包解压" aria-hidden="true">#</a> 6.9 Windows 下载 MongoDB Compass 压缩包解压</h4><h2 id="二、常用操作命令" tabindex="-1"><a class="header-anchor" href="#二、常用操作命令" aria-hidden="true">#</a> 二、常用操作命令</h2>`,62),r=s(`<h3 id="_1、数据库基本操作" tabindex="-1"><a class="header-anchor" href="#_1、数据库基本操作" aria-hidden="true">#</a> 1、数据库基本操作</h3><h4 id="_1-1-查看所有数据库" tabindex="-1"><a class="header-anchor" href="#_1-1-查看所有数据库" aria-hidden="true">#</a> 1.1 查看所有数据库</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show dbs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show databases
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>admin：管理每个数据库用户名密码，权限相关</li><li>config：使用分片的时候保存分片相关信息</li><li>local：集合不会被复制，用来存储本地单台服务器的任意集合</li></ul><h4 id="_1-2-选择和创建数据库" tabindex="-1"><a class="header-anchor" href="#_1-2-选择和创建数据库" aria-hidden="true">#</a> 1.2 选择和创建数据库</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>use admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>注意：如果数据库不存在，则新建；只有插入内容之后，才会创建数据库</p></blockquote><h4 id="_1-3-查看正在使用的数据库" tabindex="-1"><a class="header-anchor" href="#_1-3-查看正在使用的数据库" aria-hidden="true">#</a> 1.3 查看正在使用的数据库</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>注意：MongoDB 默认数据库为 test，如果没有选择数据库，集合将存放在 test 数据库中</p></blockquote><h4 id="_1-4-删除数据库" tabindex="-1"><a class="header-anchor" href="#_1-4-删除数据库" aria-hidden="true">#</a> 1.4 删除数据库</h4><div class="language-shell\\ line-numbers-mode" data-ext="shell\\"><pre class="language-shell\\"><code>db.dropDatabase()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>注意：用来删除已经持久化的数据库</p></blockquote><h3 id="_2、集合操作" tabindex="-1"><a class="header-anchor" href="#_2、集合操作" aria-hidden="true">#</a> 2、集合操作</h3><h4 id="_2-1-显示创建集合" tabindex="-1"><a class="header-anchor" href="#_2-1-显示创建集合" aria-hidden="true">#</a> 2.1 显示创建集合</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.createCollection<span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-2-查看当前数据库中的集合" tabindex="-1"><a class="header-anchor" href="#_2-2-查看当前数据库中的集合" aria-hidden="true">#</a> 2.2 查看当前数据库中的集合</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show collections
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show tables
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-3-隐式创建集合" tabindex="-1"><a class="header-anchor" href="#_2-3-隐式创建集合" aria-hidden="true">#</a> 2.3 隐式创建集合</h4><p>向一个集合中插入一个文档时，如果集合不存在，则会自动创建集合</p><h4 id="_2-4-删除集合" tabindex="-1"><a class="header-anchor" href="#_2-4-删除集合" aria-hidden="true">#</a> 2.4 删除集合</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.student.drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3、文档基本-crud" tabindex="-1"><a class="header-anchor" href="#_3、文档基本-crud" aria-hidden="true">#</a> 3、文档基本 CRUD</h3><h4 id="_3-1-文档插入操作" tabindex="-1"><a class="header-anchor" href="#_3-1-文档插入操作" aria-hidden="true">#</a> 3.1 文档插入操作</h4><ul><li><p>单个文档插入</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.student.insertOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;taiyi&quot;</span>, <span class="token string">&quot;&quot;</span><span class="token builtin class-name">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>多个文档插入</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.student.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;zs&quot;</span>, <span class="token string">&quot;age&quot;</span>:20<span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ls&quot;</span>, <span class="token string">&quot;age&quot;</span>:22<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>注意：</p><ul><li>如果该集合当前不存在，则插入操作将创建该集合</li><li>如果文档未指定 _id 字段，则 MongoDB 将具有 ObjectId 值的 _id 字段添加到新文档中</li></ul></blockquote></li></ul><h4 id="_3-2-文档查询操作" tabindex="-1"><a class="header-anchor" href="#_3-2-文档查询操作" aria-hidden="true">#</a> 3.2 文档查询操作</h4><p>插入一些数据</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span> item: <span class="token string">&quot;journal&quot;</span>, qty: <span class="token number">25</span>, size: <span class="token punctuation">{</span> h: <span class="token number">14</span>, w: <span class="token number">21</span>, uom: <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span>, status: <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span>,
   <span class="token punctuation">{</span> item: <span class="token string">&quot;notebook&quot;</span>, qty: <span class="token number">50</span>, size: <span class="token punctuation">{</span> h: <span class="token number">8.5</span>, w: <span class="token number">11</span>, uom: <span class="token string">&quot;in&quot;</span> <span class="token punctuation">}</span>, status: <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span>,
   <span class="token punctuation">{</span> item: <span class="token string">&quot;paper&quot;</span>, qty: <span class="token number">100</span>, size: <span class="token punctuation">{</span> h: <span class="token number">8.5</span>, w: <span class="token number">11</span>, uom: <span class="token string">&quot;in&quot;</span> <span class="token punctuation">}</span>, status: <span class="token string">&quot;D&quot;</span> <span class="token punctuation">}</span>,
   <span class="token punctuation">{</span> item: <span class="token string">&quot;planner&quot;</span>, qty: <span class="token number">75</span>, size: <span class="token punctuation">{</span> h: <span class="token number">22.85</span>, w: <span class="token number">30</span>, uom: <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span>, status: <span class="token string">&quot;D&quot;</span> <span class="token punctuation">}</span>,
   <span class="token punctuation">{</span> item: <span class="token string">&quot;postcard&quot;</span>, qty: <span class="token number">45</span>, size: <span class="token punctuation">{</span> h: <span class="token number">10</span>, w: <span class="token number">15.25</span>, uom: <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span>, status: <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>查询所有</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>条件查询</p><ul><li><p>等值查询</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;item&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;postcard&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>in 操作</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>status:<span class="token punctuation">{</span><span class="token variable">$in</span>:<span class="token punctuation">[</span><span class="token string">&quot;A&quot;</span>, <span class="token string">&quot;D&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>and 操作</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>status: <span class="token string">&quot;A&quot;</span>, qty: <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>or 操作</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token variable">$or</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>status: <span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>qty: <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>同时 and 和 or</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>status: <span class="token string">&quot;A&quot;</span>, <span class="token variable">$or</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>qty: <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>item: /^p/<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li><li><p>查询时返回指定字段</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>item: /a/<span class="token punctuation">}</span>, <span class="token punctuation">{</span>_id: <span class="token number">0</span>, item: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_3-3-文档更新操作" tabindex="-1"><a class="header-anchor" href="#_3-3-文档更新操作" aria-hidden="true">#</a> 3.3 文档更新操作</h4><ul><li><p>全覆盖修改</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.replaceOne<span class="token punctuation">(</span><span class="token punctuation">{</span>_id: ObjectId<span class="token punctuation">(</span><span class="token string">&quot;659d25d4d2761d6bc8be8b81&quot;</span><span class="token punctuation">)</span>, qty: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>局部修改</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span>_id: ObjectId<span class="token punctuation">(</span><span class="token string">&quot;659d25d4d2761d6bc8be8b82&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>qty: <span class="token number">49</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>列值增长修改</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span>_id: ObjectId<span class="token punctuation">(</span><span class="token string">&quot;659d25d4d2761d6bc8be8b82&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$inc</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>qty: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>更新多个文档</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.updateMany<span class="token punctuation">(</span><span class="token punctuation">{</span>qty: <span class="token punctuation">{</span><span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">99</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;size.uom&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;in&quot;</span>, status: <span class="token string">&quot;p&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_3-4-文档删除操作" tabindex="-1"><a class="header-anchor" href="#_3-4-文档删除操作" aria-hidden="true">#</a> 3.4 文档删除操作</h4><ul><li><p>删除一个文档（条件匹配多个也只删除一个）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.deleteOne<span class="token punctuation">(</span><span class="token punctuation">{</span>_id: ObjectId<span class="token punctuation">(</span><span class="token string">&quot;659d25d4d2761d6bc8be8b81&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>删除多个文档</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.deleteMany<span class="token punctuation">(</span><span class="token punctuation">{</span>status: <span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>删除满足条件的文档（过时）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.remove<span class="token punctuation">(</span><span class="token punctuation">{</span>status: <span class="token string">&quot;p&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_3-5-文档分页操作" tabindex="-1"><a class="header-anchor" href="#_3-5-文档分页操作" aria-hidden="true">#</a> 3.5 文档分页操作</h4><ul><li><p>查询总条数</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.countDocuments<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>带条件查询总条数</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.countDocuments<span class="token punctuation">(</span><span class="token punctuation">{</span>status: <span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>分页查询：使用 limit 做过滤操作，skip 跳过某些条数</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_3-6-文档排序操作" tabindex="-1"><a class="header-anchor" href="#_3-6-文档排序操作" aria-hidden="true">#</a> 3.6 文档排序操作</h4><ul><li><p>升序查询</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>qty: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>降序查询</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>qty: -1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><blockquote><p>注意：</p><p>skip()、limit()、sort() 三个放在一起执行时，执行顺序是 sort() -&gt; skip() -&gt; limit() 和命令编写顺序无关</p></blockquote><h4 id="_3-7-文档模糊查询" tabindex="-1"><a class="header-anchor" href="#_3-7-文档模糊查询" aria-hidden="true">#</a> 3.7 文档模糊查询</h4><p>正则查询</p><ul><li><p>以 p 开头</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>item: /^p/<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>包含 a</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>item: /a/<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h2 id="三、index-索引" tabindex="-1"><a class="header-anchor" href="#三、index-索引" aria-hidden="true">#</a> 三、Index 索引</h2><h3 id="_1、索引的概述" tabindex="-1"><a class="header-anchor" href="#_1、索引的概述" aria-hidden="true">#</a> 1、索引的概述</h3><p>TODO</p><h3 id="_2、索引的分类" tabindex="-1"><a class="header-anchor" href="#_2、索引的分类" aria-hidden="true">#</a> 2、索引的分类</h3><ul><li>单字段索引</li><li>复合索引</li><li>多建索引</li><li>地理空间索引</li><li>文本索引</li><li>Hashed 索引</li></ul><blockquote><p>注意：</p><p>默认的 Id 索引，在创建集合期间，MongoDB 在 _id 字段上创建唯一索引，该索引可以防止客户端插入两个具有相同值的文档。</p><p>不能将 _id 字段上的 index 删除。</p></blockquote><h3 id="_3、索引的基本操作" tabindex="-1"><a class="header-anchor" href="#_3、索引的基本操作" aria-hidden="true">#</a> 3、索引的基本操作</h3><ul><li><p>查看索引</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>创建索引</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>qty: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>创建复合索引</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>status: <span class="token number">1</span>, qty: -1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>删除索引</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.dropIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>qty:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.dropIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>注意：</p><p>_id 索引不能被删除</p></blockquote></li></ul><h3 id="_4、执行计划-面试" tabindex="-1"><a class="header-anchor" href="#_4、执行计划-面试" aria-hidden="true">#</a> 4、执行计划（面试）</h3><p>分析查询性能（Analyze Query Performance）通常使用执行计划（解释计划、Explain Plan）来查看查询情况，如查询耗费时间、是否给予索引查询等。</p><ul><li><p>查看某条查询执行计划</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>qty: <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">60</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.explain<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>winningPlan<span class="token operator">:</span> <span class="token punctuation">{</span>
    stage<span class="token operator">:</span> &#39;COLLSCAN&#39;<span class="token punctuation">,</span>
    filter<span class="token operator">:</span> <span class="token punctuation">{</span> qty<span class="token operator">:</span> <span class="token punctuation">{</span> &#39;$lt&#39;<span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    direction<span class="token operator">:</span> &#39;forward&#39;
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>建立索引后观察</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>qty: <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">60</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.explain<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>winningPlan: <span class="token punctuation">{</span>
    stage: <span class="token string">&#39;FETCH&#39;</span>,
    inputStage: <span class="token punctuation">{</span>
    stage: <span class="token string">&#39;IXSCAN&#39;</span>,
    keyPattern: <span class="token punctuation">{</span> qty: <span class="token number">1</span> <span class="token punctuation">}</span>,
    indexName: <span class="token string">&#39;qty_1&#39;</span>,
    isMultiKey: false,
    multiKeyPaths: <span class="token punctuation">{</span> qty: <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>,
    isUnique: false,
    isSparse: false,
    isPartial: false,
    indexVersion: <span class="token number">2</span>,
    direction: <span class="token string">&#39;forward&#39;</span>,
    indexBounds: <span class="token punctuation">{</span> qty: <span class="token punctuation">[</span> <span class="token string">&#39;[-inf.0, 60)&#39;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>回表查询（面试重点）</p><p>Covered Queries 当查询的字段和查询的投影进包含索引字段时，MongoDB 直接从索引返回结果，而不扫描任何文档或将文档带入内存。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span>qty: <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">60</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>_id: <span class="token number">0</span>, qty: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.explain<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>winningPlan<span class="token operator">:</span> <span class="token punctuation">{</span>
    stage<span class="token operator">:</span> &#39;PROJECTION_COVERED&#39;<span class="token punctuation">,</span>	<span class="token comment">// 投影覆盖</span>
    transformBy<span class="token operator">:</span> <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    inputStage<span class="token operator">:</span> <span class="token punctuation">{</span>
        stage<span class="token operator">:</span> &#39;IXSCAN&#39;<span class="token punctuation">,</span>
        keyPattern<span class="token operator">:</span> <span class="token punctuation">{</span> qty<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        indexName<span class="token operator">:</span> &#39;qty_1&#39;<span class="token punctuation">,</span>
        isMultiKey<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        multiKeyPaths<span class="token operator">:</span> <span class="token punctuation">{</span> qty<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        isUnique<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isSparse<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isPartial<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        indexVersion<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        direction<span class="token operator">:</span> &#39;forward&#39;<span class="token punctuation">,</span>
        indexBounds<span class="token operator">:</span> <span class="token punctuation">{</span> qty<span class="token operator">:</span> <span class="token punctuation">[</span> &#39;<span class="token punctuation">[</span>-inf.<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span>)&#39; <span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="四、springboot-整合-mongodb" tabindex="-1"><a class="header-anchor" href="#四、springboot-整合-mongodb" aria-hidden="true">#</a> 四、SpringBoot 整合 MongoDB</h2><h3 id="_1、创建-springboot-项目" tabindex="-1"><a class="header-anchor" href="#_1、创建-springboot-项目" aria-hidden="true">#</a> 1、创建 SpringBoot 项目</h3><h4 id="_1-1-导入相关依赖" tabindex="-1"><a class="header-anchor" href="#_1-1-导入相关依赖" aria-hidden="true">#</a> 1.1 导入相关依赖</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-配置文件" tabindex="-1"><a class="header-anchor" href="#_1-2-配置文件" aria-hidden="true">#</a> 1.2 配置文件</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.81.128
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> articleData
      <span class="token comment"># uri: mongodb://192.168.81.128:27017/articleData</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、案例说明" tabindex="-1"><a class="header-anchor" href="#_2、案例说明" aria-hidden="true">#</a> 2、案例说明</h3><p>模仿实现知乎文章、评论、点赞功能</p><h3 id="_3、功能实现" tabindex="-1"><a class="header-anchor" href="#_3、功能实现" aria-hidden="true">#</a> 3、功能实现</h3><p>3.1 新增文章</p><p>3.2 文章点赞</p><p>3.3 文章评论</p><p>3.4 评论评论</p><p>3.5 评论点赞</p><p>3.6 查看文章的直接评论</p><p>3.7 查看评论下的评论</p><h3 id="_4、代码" tabindex="-1"><a class="header-anchor" href="#_4、代码" aria-hidden="true">#</a> 4、代码</h3><h4 id="_4-1-application-yml" tabindex="-1"><a class="header-anchor" href="#_4-1-application-yml" aria-hidden="true">#</a> 4.1 application.yml</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.81.128
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> articleData
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-domain" tabindex="-1"><a class="header-anchor" href="#_4-2-domain" aria-hidden="true">#</a> 4.2 domain</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 文章id
     */</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 文章标题
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 文章内容
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 用户昵称
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 点赞数
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> totalLikeCount<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 评论数
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> totalReplyCount<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 发布日期
     */</span>
    <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createDataTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Comment</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> publishTime<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Indexed</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> likeCount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> replyCount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> parentId<span class="token punctuation">;</span>    <span class="token comment">// 上一条评论ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> articleId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-dao" tabindex="-1"><a class="header-anchor" href="#_4-3-dao" aria-hidden="true">#</a> 4.3 dao</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CommentRepository</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByArticleId</span><span class="token punctuation">(</span><span class="token class-name">String</span> articleId<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByParentId</span><span class="token punctuation">(</span><span class="token class-name">String</span> parentId<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-service" tabindex="-1"><a class="header-anchor" href="#_4-4-service" aria-hidden="true">#</a> 4.4 service</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IArticleService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 保存文章
     *
     * <span class="token keyword">@param</span> <span class="token parameter">article</span> 文章
     */</span>
    <span class="token keyword">void</span> <span class="token function">saveArticle</span><span class="token punctuation">(</span><span class="token class-name">Article</span> article<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 点赞+1
     *
     * <span class="token keyword">@param</span> <span class="token parameter">id</span> 文章ID
     */</span>
    <span class="token keyword">void</span> <span class="token function">updateArticleLikeCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 文件评论+1
     *
     * <span class="token keyword">@param</span> <span class="token parameter">articleId</span> 文章ID
     */</span>
    <span class="token keyword">void</span> <span class="token function">updateArticleReplyCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;articleService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IArticleService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleRepository</span> articleRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveArticle</span><span class="token punctuation">(</span><span class="token class-name">Article</span> article<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateArticleLikeCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setTotalLikeCount</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">getTotalLikeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateArticleReplyCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> articleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article<span class="token punctuation">.</span><span class="token function">setTotalReplyCount</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">getTotalReplyCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICommentService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 保存评论
     *
     * <span class="token keyword">@param</span> <span class="token parameter">comment</span> 评论
     */</span>
    <span class="token keyword">void</span> <span class="token function">saveComment</span><span class="token punctuation">(</span><span class="token class-name">Comment</span> comment<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 评论点赞+1
     *
     * <span class="token keyword">@param</span> <span class="token parameter">commentId</span> 评论ID
     */</span>
    <span class="token keyword">void</span> <span class="token function">updateCommentLikeCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> commentId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 分页查看文章下评论
     *
     * <span class="token keyword">@param</span> <span class="token parameter">articleId</span> 文章ID
     * <span class="token keyword">@param</span> <span class="token parameter">pageNum</span>   当前页（0开始）
     * <span class="token keyword">@param</span> <span class="token parameter">pageSize</span>  每页大小
     * <span class="token keyword">@return</span> 分页评论
     */</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">findCommentListByArticleId</span><span class="token punctuation">(</span><span class="token class-name">String</span> articleId<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNum<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 查看评论的评论
     *
     * <span class="token keyword">@param</span> <span class="token parameter">parentId</span> 上级评论ID
     * <span class="token keyword">@param</span> <span class="token parameter">pageNum</span>  当前页
     * <span class="token keyword">@param</span> <span class="token parameter">pageSize</span> 每页大小
     * <span class="token keyword">@return</span> 分页评论
     */</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">findCommentListByParentId</span><span class="token punctuation">(</span><span class="token class-name">String</span> parentId<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNum<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;commentService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommentServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ICommentService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">CommentRepository</span> commentRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveComment</span><span class="token punctuation">(</span><span class="token class-name">Comment</span> comment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        commentRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateCommentLikeCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> commentId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Comment</span> comment <span class="token operator">=</span> commentRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>commentId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        comment<span class="token punctuation">.</span><span class="token function">setLikeCount</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span><span class="token function">getLikeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        commentRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">findCommentListByArticleId</span><span class="token punctuation">(</span><span class="token class-name">String</span> articleId<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNum<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> commentRepository<span class="token punctuation">.</span><span class="token function">findByArticleId</span><span class="token punctuation">(</span>articleId<span class="token punctuation">,</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>pageNum<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">findCommentListByParentId</span><span class="token punctuation">(</span><span class="token class-name">String</span> parentId<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNum<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> commentRepository<span class="token punctuation">.</span><span class="token function">findByParentId</span><span class="token punctuation">(</span>parentId<span class="token punctuation">,</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>pageNum<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-5-controller" tabindex="-1"><a class="header-anchor" href="#_4-5-controller" aria-hidden="true">#</a> 4.5 controller</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/article&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">IArticleService</span> articleService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 添加文章
     *
     * <span class="token keyword">@param</span> <span class="token parameter">article</span> 文章参数
     * <span class="token keyword">@return</span> 是否成功
     */</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveArticle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Article</span> article<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        articleService<span class="token punctuation">.</span><span class="token function">saveArticle</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 点赞+1
     *
     * <span class="token keyword">@param</span> <span class="token parameter">articleId</span> 文章ID
     * <span class="token keyword">@return</span> 是否成功
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/like&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">articleLikeCount</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> articleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        articleService<span class="token punctuation">.</span><span class="token function">updateArticleLikeCount</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/comment&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommentController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">ICommentService</span> commentService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">IArticleService</span> articleService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 添加评论
     *
     * <span class="token keyword">@param</span> <span class="token parameter">comment</span> 评论参数
     * <span class="token keyword">@return</span> 是否成功
     */</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveComment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Comment</span> comment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        commentService<span class="token punctuation">.</span><span class="token function">saveComment</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleService<span class="token punctuation">.</span><span class="token function">updateArticleReplyCount</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 评论点赞+1
     *
     * <span class="token keyword">@param</span> <span class="token parameter">commentId</span> 评论ID
     * <span class="token keyword">@return</span> 是否成功
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/like&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">commentLikeCount</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> commentId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        commentService<span class="token punctuation">.</span><span class="token function">updateCommentLikeCount</span><span class="token punctuation">(</span>commentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 分页查看文章下评论
     *
     * <span class="token keyword">@param</span> <span class="token parameter">articleId</span> 文章ID
     * <span class="token keyword">@param</span> <span class="token parameter">pageNum</span>   当前页（从0开始）
     * <span class="token keyword">@param</span> <span class="token parameter">pageSize</span>  每页大小
     * <span class="token keyword">@return</span> 分页评论
     */</span>
    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">listComment</span><span class="token punctuation">(</span><span class="token class-name">String</span> articleId<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNum<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> commentService<span class="token punctuation">.</span><span class="token function">findCommentListByArticleId</span><span class="token punctuation">(</span>articleId<span class="token punctuation">,</span> pageNum<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 查看评论的评论
     *
     * <span class="token keyword">@param</span> <span class="token parameter">parentId</span> 上级评论ID
     * <span class="token keyword">@param</span> <span class="token parameter">pageNum</span>  当前页（从0开始）
     * <span class="token keyword">@param</span> <span class="token parameter">pageSize</span> 每页大小
     * <span class="token keyword">@return</span> 分页评论
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/son&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Comment</span><span class="token punctuation">&gt;</span></span> <span class="token function">listCommentSon</span><span class="token punctuation">(</span><span class="token class-name">String</span> parentId<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNum<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> commentService<span class="token punctuation">.</span><span class="token function">findCommentListByParentId</span><span class="token punctuation">(</span>parentId<span class="token punctuation">,</span> pageNum<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="五、副本集-replica-sets" tabindex="-1"><a class="header-anchor" href="#五、副本集-replica-sets" aria-hidden="true">#</a> 五、副本集-Replica Sets</h2><h3 id="_1、简介" tabindex="-1"><a class="header-anchor" href="#_1、简介" aria-hidden="true">#</a> 1、简介</h3><blockquote><ul><li>MongoDB中的副本集(复制集)是一组维护相同数据集的monhead进程服务.副本集可提供冗余和高可用性，是所有生产部署的基础；</li><li>副本集类似于有自动故障恢复功能的主从集群是多台机器进行同一数据的异步同步，从而使多台机器拥有同一数据的多个副本，并且当主库挂掉时在不需要用户干预的情况下自动切换其他备份服务器做主库；</li><li>而且还可以利用副本服务器做只读服务器，实现读写分离，提高负载。</li></ul></blockquote><ul><li><p>冗余和数据可用性：</p><p>复制提供了冗余并增加了数据可用性；</p><p>对于不同数据库服务器上的多个数据副本，复制为防止单台数据库服务器故障提供了一定程度的容错能力</p></li><li><p>MongoDB 的复制：</p><p>副本集是一组维护相同数据集合的 mongod 实例；</p><p>副本集包含多个数据承载节点和一个可选的仲裁节点，在数据承载节点中，有且仅有一个成员为主节点，其他节点为从节点</p></li></ul><h3 id="_2、副本集成员" tabindex="-1"><a class="header-anchor" href="#_2、副本集成员" aria-hidden="true">#</a> 2、副本集成员</h3><p>MongoDB 的副本集是一组提供冗余和高可用性的 mongod进程，一个副本集成员有：</p><ul><li>主节点</li><li>从节点</li></ul><p>TODO 图</p><h3 id="_3、副本集的类型和角色" tabindex="-1"><a class="header-anchor" href="#_3、副本集的类型和角色" aria-hidden="true">#</a> 3、副本集的类型和角色</h3><p>副本集有看两种类型三种角色：</p><ul><li>两种类型： <ul><li>主节点（Primary）类型：数据操作的主要连接点，可读写</li><li>次要节点（Secondaries）类型：数据冗余备份节点，可以读或选举</li></ul></li><li>三种角色： <ul><li>主节点（Primary）：主要接受所有写操作</li><li>副本成员（Replicate）：从主节点通过复制操作以维护相同的数据集，即备份数据，不可写操作，但可以读操作（需要配置）。是默认的一种从节点类型</li><li>仲裁者（Arbiter）：不保留任何数据的副本，值具有投票选举作用。也可以将仲裁服务器维护为副本集的一部分，即副本成员同时也可以是仲裁者，也是一种从节点类型</li></ul></li></ul><p>TODO 图</p><h3 id="_4、副本集的搭建" tabindex="-1"><a class="header-anchor" href="#_4、副本集的搭建" aria-hidden="true">#</a> 4、副本集的搭建</h3><p>准备三个 MongoDB 实例：</p><ul><li>主节点：27017</li><li>从节点：27018</li><li>仲裁节点：27019</li></ul><h4 id="_4-1-创建主节点" tabindex="-1"><a class="header-anchor" href="#_4-1-创建主节点" aria-hidden="true">#</a> 4.1 创建主节点</h4><ul><li><p>创建存放数据和日志目录文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/replica_sets/27017/log
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/replica_sets/27017/data/db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建配置文件 mongod.conf</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /usr/local/mongodb/replica_sets/27017/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
  <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27017/log/mongod.log&quot;</span>
  <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27017/data/db&quot;</span>
  <span class="token key atrule">journal</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
  <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27017/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
  <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 192.168.81.128
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
  <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> mongo_rs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动节点服务</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /usr/local/mongodb/replica_sets/27017/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_4-2-创建副本节点" tabindex="-1"><a class="header-anchor" href="#_4-2-创建副本节点" aria-hidden="true">#</a> 4.2 创建副本节点</h4><ul><li><p>创建存放数据和日志目录文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/replica_sets/27018/log
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/replica_sets/27018/data/db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建配置文件 mongod.conf</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /usr/local/mongodb/replica_sets/27018/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
  <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27018/log/mongod.log&quot;</span>
  <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27018/data/db&quot;</span>
  <span class="token key atrule">journal</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
  <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27018/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
  <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 192.168.81.128
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
  <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> mongo_rs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动节点服务</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /usr/local/mongodb/replica_sets/27018/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_4-3-创建仲裁节点" tabindex="-1"><a class="header-anchor" href="#_4-3-创建仲裁节点" aria-hidden="true">#</a> 4.3 创建仲裁节点</h4><ul><li><p>创建存放数据和日志目录文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/replica_sets/27019/log
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/mongodb/replica_sets/27019/data/db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建配置文件 mongod.conf</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /usr/local/mongodb/replica_sets/27019/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
  <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27019/log/mongod.log&quot;</span>
  <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27019/data/db&quot;</span>
  <span class="token key atrule">journal</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
  <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/mongodb/replica_sets/27019/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
  <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 192.168.81.128
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
  <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> mongo_rs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动节点服务</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/mongodb/bin/mongod <span class="token parameter variable">-f</span> /usr/local/mongodb/replica_sets/27019/mongod.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_4-4-初始化主节点和副本集" tabindex="-1"><a class="header-anchor" href="#_4-4-初始化主节点和副本集" aria-hidden="true">#</a> 4.4 初始化主节点和副本集</h4><ul><li><p>mongosh 连接上主节点</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/mongosh/bin/mongosh <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token number">192.168</span>.222.135 <span class="token parameter variable">--port</span> <span class="token number">27017</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>先做副本集初始化（否则很多命令不能用）默认的初始化方式</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rs.initiate<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h4 id="_4-5-查看副本集的配置内容" tabindex="-1"><a class="header-anchor" href="#_4-5-查看副本集的配置内容" aria-hidden="true">#</a> 4.5 查看副本集的配置内容</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rs.conf<span class="token punctuation">(</span>configuration<span class="token punctuation">)</span>
rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>TODO：内容</p><ul><li>配置说明 <ul><li>_id:&#39;mongo_rs&#39;：副本集的配置数据存储的主键值，默认就是副本集的名字</li><li>members：副本集成员数组 <ul><li>arbiterOnly:false：该成员不是仲裁节点</li><li>priority:1 优先级（权重值）</li></ul></li><li>settings：副本集参数配置</li></ul></li><li>rs.conf() 副本集配置的查看命令，本质上是查看 system.replset 表中的数据</li><li>TODO 查看表中数据</li></ul><h4 id="_4-6-查看副本集的状态" tabindex="-1"><a class="header-anchor" href="#_4-6-查看副本集的状态" aria-hidden="true">#</a> 4.6 查看副本集的状态</h4><p>从副本集的其他成员发送的心跳包中获得的数据反映副本集的状态</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>TODO 内容</p><ul><li>set:&#39;mongo_rs&#39;：副本集名称</li><li>myState:1：状态正常</li><li>members：副本集成员数组 <ul><li>name:&#39;192.168.222.135:27017&#39;：成员只有一个</li><li>health:1：健康节点</li><li>stateStr:&#39;PRIMARY&#39;：角色</li></ul></li></ul><h4 id="_4-7-添加副本从节点" tabindex="-1"><a class="header-anchor" href="#_4-7-添加副本从节点" aria-hidden="true">#</a> 4.7 添加副本从节点</h4><ul><li><p>从主节点添加从节点，将其他成员加入到副本集（将 27018 添加为从节点）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># rs.add(host,arbiterOnly)</span>
rs.add<span class="token punctuation">(</span><span class="token string">&quot;192.168.222.135:27018&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>TODO 内容</p></li><li></li></ul>`,121);function k(v,m){const e=c("RouterLink");return p(),i("div",null,[d,n("blockquote",null,[n("p",null,[a("官网文档学习："),l(e,{to:"/%E7%AC%94%E8%AE%B0/https:/docs.mongoing.com/"},{default:o(()=>[a("MongoDB中文手册")]),_:1})])]),r])}const g=t(u,[["render",k],["__file","MongoDB.html.vue"]]);export{g as default};
